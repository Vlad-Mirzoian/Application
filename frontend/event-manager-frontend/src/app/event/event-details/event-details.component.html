<div class="min-h-screen bg-gray-50 py-8">
  <div
    *ngIf="submitResult$ | async as result"
    class="fixed top-20 left-1/2 transform -translate-x-1/2 z-50 animate-in slide-in-from-top duration-300"
  >
    <div
      [ngClass]="{
        'bg-green-50 border border-green-200 text-green-700': result.success,
        'bg-red-50 border border-red-200 text-red-700': !result.success
      }"
      class="px-5 py-3 rounded-lg shadow-lg flex items-center text-sm font-medium min-w-max"
    >
      <svg
        *ngIf="result.success"
        class="w-5 h-5 mr-2"
        fill="currentColor"
        viewBox="0 0 20 20"
      >
        <path
          fill-rule="evenodd"
          d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
          clip-rule="evenodd"
        />
      </svg>
      <svg
        *ngIf="!result.success"
        class="w-5 h-5 mr-2"
        fill="currentColor"
        viewBox="0 0 20 20"
      >
        <path
          fill-rule="evenodd"
          d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
          clip-rule="evenodd"
        />
      </svg>
      {{ result.message }}
    </div>
  </div>
  <div class="container mx-auto px-4 max-w-4xl">
    <ng-container *ngIf="event$ | async as event; else loading">
      <div
        class="bg-white rounded-2xl shadow-lg p-8 border border-gray-200 transition-all duration-300 hover:shadow-xl"
      >
        <h2 class="text-3xl font-bold text-gray-900 mb-4">{{ event.title }}</h2>
        <div class="flex flex-wrap gap-2 mb-4">
          <span
            *ngFor="let tag of event.tags"
            class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800"
          >
            {{ tag.name }}
          </span>
        </div>
        <div class="space-y-5 text-gray-700">
          <p class="flex items-center text-base">
            <svg
              class="w-5 h-5 mr-3 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
            <strong class="mr-2">Date:</strong>
            {{ event.startDateTime | date : "fullDate" }}
          </p>

          <p class="flex items-center text-base">
            <svg
              class="w-5 h-5 mr-3 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <strong class="mr-2">Time:</strong>
            {{ event.startDateTime | date : "HH:mm" }}
          </p>

          <p class="flex items-center text-base">
            <svg
              class="w-5 h-5 mr-3 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
              />
            </svg>
            <strong class="mr-2">Location:</strong>
            {{ event.location }}
          </p>

          <p class="flex items-center text-base font-medium">
            <svg
              class="w-5 h-5 mr-3 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
              />
            </svg>
            <strong class="mr-2">Participants:</strong>
            {{ event.participantCount }}
            <span *ngIf="event.capacity" class="text-gray-500"
              >/ {{ event.capacity }}</span
            >
          </p>

          <p class="flex items-center text-base">
            <svg
              class="w-5 h-5 mr-3 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
              />
            </svg>
            <strong class="mr-2">Created by:</strong>
            {{ event.creatorEmail }}
          </p>

          <div class="flex items-start text-base">
            <svg
              class="w-5 h-5 mr-3 text-gray-500 mt-0.5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            <div>
              <strong class="block mb-1">Description:</strong>
              <p class="text-gray-600">
                {{ event.description || "No description" }}
              </p>
            </div>
          </div>
        </div>

        <div
          *ngIf="
            isAuthenticated &&
            userId !== event.creatorId &&
            (userEvents$ | async) as userEvents
          "
          class="mt-8 space-y-3"
        >
          <button
            *ngIf="isUserParticipant(event.id, userEvents)"
            (click)="leaveEvent(event.id)"
            class="w-full bg-red-600 text-white font-medium py-3 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-100 transition-all duration-200 shadow-sm"
          >
            Leave Event
          </button>

          <div
            *ngIf="
              !isUserParticipant(event.id, userEvents) &&
              event.participantCount >= (event.capacity ?? Number.MAX_VALUE)
            "
            class="w-full bg-gray-100 text-gray-600 font-medium py-3 rounded-lg text-center select-none"
          >
            Event is Full
          </div>

          <button
            *ngIf="
              !isUserParticipant(event.id, userEvents) &&
              event.participantCount < (event.capacity ?? Number.MAX_VALUE)
            "
            (click)="joinEvent(event.id)"
            class="w-full bg-green-600 text-white font-medium py-3 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-100 transition-all duration-200 shadow-sm"
          >
            Join Event
          </button>
        </div>

        <div
          *ngIf="isAuthenticated && userId === event.creatorId"
          class="mt-8 flex gap-3"
        >
          <a
            [routerLink]="['/events', event.id, 'edit']"
            class="flex-1 bg-purple-600 text-white font-medium py-3 rounded-lg text-center hover:bg-purple-700 focus:outline-none focus:ring-4 focus:ring-purple-100 transition-all duration-200 shadow-sm"
          >
            Edit Event
          </a>
          <button
            (click)="deleteEvent(event.id)"
            class="flex-1 bg-red-600 text-white font-medium py-3 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-100 transition-all duration-200 shadow-sm"
          >
            Delete Event
          </button>
        </div>
      </div>
    </ng-container>

    <ng-template #loading>
      <div class="text-center py-12">
        <div
          class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"
        ></div>
        <p class="mt-3 text-gray-600">Loading event...</p>
      </div>
    </ng-template>
  </div>
</div>
